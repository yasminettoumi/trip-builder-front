<link rel="stylesheet"
 href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<div class="card search-card">

  <form [formGroup]="form" (ngSubmit)="search()" class="search-form">

    <div class="field">
      <label><i class="fa-solid fa-plane-departure"></i> From</label>
      <select formControlName="from">
        <option value="">Select departure</option>
        <option *ngFor="let a of airports" [value]="a.code">
          {{ a.city }} ({{ a.code }})
        </option>
      </select>
    </div>

    <div class="field">
      <label><i class="fa-solid fa-plane-arrival"></i> To</label>
      <select formControlName="to">
        <option value="">Select destination</option>
        <option *ngFor="let a of airports" [value]="a.code">
          {{ a.city }} ({{ a.code }})
        </option>
      </select>
    </div>

    <div class="field">
  <label>
    <i class="fa-regular fa-calendar"></i> Departure 
  </label>
  <input type="date"
         formControlName="departure_date"
         [min]="today" />
</div>

    <div class="field" *ngIf="form.value.type === 'round_trip'">
      <label><i class="fa-regular fa-calendar-check"></i> Return</label>
      <input type="date" formControlName="return_date" />
    </div>

    <div class="field">
      <label><i class="fa-solid fa-route"></i> Trip type</label>
      <select formControlName="type">
        <option value="one_way">One-way</option>
        <option value="round_trip">Round-trip</option>
      </select>
    </div>

    <div class="field search-btn">
      <button type="submit" [disabled]="form.invalid">
        <i class="fa-solid fa-magnifying-glass"></i> Search
      </button>
    </div>

  </form>

  <div *ngIf="loading" class="loading">
    <i class="fa-solid fa-spinner fa-spin"></i> Searching flights...
  </div>

  <div *ngIf="error" class="error">
    <i class="fa-solid fa-triangle-exclamation"></i> {{ error }}
  </div>

</div>
<div *ngIf="trip" class="card result-card">

  <h3>
    <i class="fa-solid fa-suitcase-rolling"></i>
    Trip summary
  </h3>

  <p class="price">
    <i class="fa-solid fa-dollar-sign"></i>
    Total price:
    <strong>{{ trip.total_price | currency:'USD' }}</strong>
  </p>

  <div class="flight" *ngFor="let f of trip.flights">
    <div class="flight-row">
      <strong>
        <i class="fa-solid fa-plane"></i>
        {{ f.airline.name }} {{ f.airline.code }}{{ f.number }}
      </strong>
    </div>

    <div class="flight-row">
      {{ f.departure_airport.city }} ({{ f.departure_airport.code }})
      →
      {{ f.arrival_airport.city }} ({{ f.arrival_airport.code }})
    </div>

    <div class="flight-row time">
      <i class="fa-regular fa-clock"></i>
      {{ f.departure_time }} → {{ f.arrival_time }}
    </div>
  </div>

</div>
<a *ngIf="trip"
   [routerLink]="['/trips', trip.trip_id]"
   class="details-link">
  View trip details →
</a>
